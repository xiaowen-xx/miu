/* ========================================= */
/* ★★★ [核心] PWA全屏适配基础样式 ★★★ */
/* ========================================= */

:root {
    --app-height: 100dvh; /* 动态视口高度 */
    --safe-top: env(safe-area-inset-top);
    --safe-bottom: env(safe-area-inset-bottom);
    --safe-left: env(safe-area-inset-left);
    --safe-right: env(safe-area-inset-right);
    --bg-color: #F5F5F5;
}

/* ★ 基础重置 */
html {
    -webkit-text-size-adjust: 100%;
    height: 100%;
    height: -webkit-fill-available; /* iOS Safari关键属性 */
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    outline: none;
    -webkit-touch-callout: none; /* 禁止长按弹出菜单 */
}

/* ★ Body - 撑满屏幕的关键 */
body {
    background-color: var(--bg-color);
    width: 100%;
    
    /* 多重高度适配 - 确保兼容性 */
    height: 100%;
    height: 100vh;
    height: 100dvh; /* 动态视口高度 - 现代浏览器 */
    height: var(--app-height); /* JS动态计算的高度 */
    min-height: -webkit-fill-available; /* iOS Safari */
    
    overflow: hidden; /* 禁止页面级滚动 */
    
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
    color: #333;
    
    /* 壁纸相关 */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    
    /* ★ 防止iOS橡皮筋回弹效果 */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    
    /* Flex布局承载子元素 */
    display: flex;
    flex-direction: column;
    
    transition: background-image 0.3s ease;
}

/* ★ 主容器 - 撑满 */
.phone-frame {
    width: 100%;
    height: 100%;
    flex: 1; /* 关键：自动填充剩余空间 */
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    background-color: rgba(245, 245, 245, 0.5);
}

body.has-wallpaper .phone-frame {
    background-color: transparent;
}

/* --- [自定义] Miu的聊天气泡与布局 --- */
        .msg-bubble { 
            padding: 10px 14px; /* 内边距：让字离边框远一点 */
            font-size: 15px; 
            line-height: 1.5; 
            position: relative; 
            word-wrap: break-word; 
            max-width: 100%;
        }

        /* 对方的气泡 (默认白色) */
        .message-row.other .msg-bubble { 
            background: #fff; 
            color: #333;
            border-radius: 18px 18px 18px 4px; /* 左下角尖一点 */
            box-shadow: 0 1px 2px rgba(0,0,0,0.05); /* 淡淡的阴影 */
        }

        /* ★★★ Miu-miu.user (我方气泡自定义区) ★★★ */
        /* 你可以在这里修改你想要的一切！ */
        .message-row.self .msg-bubble { 
            /* 1. 背景颜色：可以使用 hex颜色(#ffc0cb) 或 rgb */
            background: #FFD1DC; /* 这里我设成了Miu粉色，你可以改！ */
            
            /* 2. 字体颜色 */
            color: #000; 

            /* 3. 气泡圆角：四个值分别是 左上 右上 右下 左下 */
            border-radius: 18px 18px 4px 18px; /* 右下角尖一点 */
            
            /* 4. 去除奇怪的黄色圈圈/阴影 */
            box-shadow: none !important; 
            outline: none !important;
            border: none !important;

            /* 5. (可选) 如果想要边框，把上面border删掉，写下面这句: */
            /* border: 2px solid #ff69b4; */
        }

        .msg-time { 
            font-size: 10px; 
            color: #999; 
            margin: 0 6px; /* 时间和气泡的间距 */
            align-self: flex-end; /* 让时间沉底 */
            white-space: nowrap;
        }

        /* [解释] 核心CSS变量 */
        :root {
            --app-height: 100dvh; 
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
            --bg-color: #F5F5F5; 
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            background-color: var(--bg-color); 
            width: 100vw; 
            height: var(--app-height);
            overflow: hidden; 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif; 
            color: #333; 
            background-size: cover; background-position: center; background-repeat: no-repeat;
            transition: background-image 0.3s ease;
        }
        
        .phone-frame { width: 100%; height: 100%; background-color: rgba(245, 245, 245, 0.5); position: relative; overflow: hidden; display: flex; flex-direction: column; }
        body.has-wallpaper .phone-frame { background-color: transparent; }

        .screen-content {
    flex: 1;
    width: 100%;
    position: relative;
    overflow-y: auto;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    
    /* ★ 安全区域适配 */
    padding-top: calc(10px + var(--safe-top));
    padding-bottom: calc(90px + var(--safe-bottom));
    
    scrollbar-width: none;
    -ms-overflow-style: none;
    -webkit-overflow-scrolling: touch; /* iOS惯性滚动 */
}
        .screen-content::-webkit-scrollbar { display: none; }

        .profile-section { width: 92%; margin-top: -20px; position: relative; z-index: 5; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; }
        .avatar { width: 85px; height: 85px; border-radius: 50%; border: 4px solid #fff; object-fit: cover; position: absolute; top: -40px; z-index: 10; box-shadow: 0 4px 10px rgba(0,0,0,0.1); background: #ddd; cursor: pointer; }
        .info-card { background-color: #fff; width: 100%; border-radius: 15px 15px 25px 25px; padding-top: 45px; padding-bottom: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.03); display: flex; flex-direction: column; align-items: center; }
        .kaomoji { font-size: 15px; font-weight: bold; margin: 5px 0; cursor: pointer; padding: 2px 10px; border-radius: 10px;} .kaomoji:active { background: #f0f0f0; }
        .text-group { display: flex; flex-direction: column; align-items: center; margin-top: 5px; }
        .editable-text { cursor: pointer; padding: 2px 5px; border-radius: 4px; } .editable-text:active { background: #f0f0f0; }
        .handle { font-size: 11px; color: #bbb; margin-bottom: 4px; }
        .bio { font-size: 11px; color: #333; margin-bottom: 4px; }
        .location { font-size: 11px; color: #999; display: flex; align-items: center; justify-content: center; gap: 4px; cursor: pointer; padding: 2px 5px; border-radius: 4px;} .location:active { background: #f0f0f0; }
        
        .section-title { font-size: 12px; font-weight: 600; color: #333; width: 92%; text-align: center; z-index: 5; flex-shrink: 0; cursor: pointer; margin-top: 15px; margin-bottom: 8px; }
        
        /* Layout */
        .main-layout-row { width: 100%; padding: 0 4%; display: flex; justify-content: space-between; align-items: flex-start; flex-shrink: 0; margin-bottom: 10px; }
        .kawaii-wrapper { width: 47%; min-width: 140px; position: relative; z-index: 5; display: flex; flex-direction: column; align-items: center; margin-top: 5px; }
        .avatar-row { display: flex; justify-content: center; gap: 12px; margin-bottom: 12px; z-index: 20; position: relative; top: 5px; }
        .kawaii-avatar { width: 46px; height: 46px; border-radius: 50%; object-fit: cover; background: #ddd; cursor: pointer; }
        .kawaii-card { background: #F3F3F3; width: 100%; border-radius: 20px; padding: 8px 5px 10px 5px; display: flex; flex-direction: column; align-items: center; position: relative; }
        .kawaii-text { font-size: 10px; color: #666; font-weight: 500; margin-bottom: 6px; cursor: pointer; white-space: nowrap; transform: scale(0.95); }
        .kawaii-white-box { background: #ffffff; width: 94%; border-radius: 14px; padding: 8px 4px; display: flex; flex-direction: column; align-items: center; }
        .k-time-text { font-size: 20px; font-weight: 400; color: #333; }
        .k-date-text { font-size: 9px; color: #999; margin-bottom: 6px; }
        .k-icons-row { display: flex; gap: 8px; justify-content: center; }
        .k-icon-btn { width: 28px; height: 28px; border-radius: 50%; background-color: #F3F3F3; display: flex; align-items: center; justify-content: center; color: #555; }
        .k-icon-btn i { font-size: 12px; }
        /* [修改] 蓝牙图标单独放大 */
        .bluetooth-icon { font-size: 15.5px !important; }
        .kawaii-bottom-text { font-size: 14px; font-weight: 700; color: #333; margin-top: 18px; cursor: pointer; text-align: center; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-family: 'Georgia', serif; }

        .right-column { width: 47%; display: flex; flex-direction: column; gap: 12px; padding-top: 0; }
        .right-apps-row { display: flex; justify-content: space-between; width: 100%; padding: 0 5px; }
        .mini-app-item { display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; }
        .mini-app-icon { width: 55px; height: 55px; background: #fff; border-radius: 18px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); display: flex; align-items: center; justify-content: center; font-size: 20px; color: #ccc; overflow: hidden; }
        .mini-app-icon img { width: 100%; height: 100%; object-fit: cover; }
        .mini-app-label { font-size: 10px; color: #666; }

        .camera-widget { width: 100%; display: flex; flex-direction: column; align-items: center; position: relative; }
        .captcha-top { background: #fff; border: 1px solid #dcdcdc; border-radius: 4px; padding: 4px 8px; display: flex; align-items: center; gap: 8px; width: 80%; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 8px; z-index: 2; }
        .captcha-checkbox { width: 16px; height: 16px; border: 2px solid #c1c1c1; border-radius: 2px; background: #fff; }
        .captcha-label { font-size: 11px; font-weight: 500; color: #333; font-family: Arial, sans-serif; cursor: pointer; }
        .captcha-body { background: #fff; border: 1px solid #dcdcdc; padding: 8px; border-radius: 6px; width: 100%; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 6px; z-index: 1; position: relative; }
        .captcha-body::before { content: ''; position: absolute; top: -6px; left: 20px; width: 10px; height: 10px; background: #fff; border-left: 1px solid #dcdcdc; border-top: 1px solid #dcdcdc; transform: rotate(45deg); z-index: 2; }
        .captcha-input-row { display: flex; gap: 5px; height: 24px; }
        .captcha-input { flex: 1; border: 1px solid #dcdcdc; font-size: 10px; padding: 0 5px; color: #999; display: flex; align-items: center; cursor: pointer; }
        .captcha-verify-btn { background: #555; color: #fff; font-size: 10px; font-weight: bold; padding: 0 8px; display: flex; align-items: center; justify-content: center; border-radius: 2px; }
        .captcha-content-row { display: flex; gap: 5px; height: 80px; }
        .captcha-img-container { flex: 1; border: 1px solid #eee; overflow: hidden; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .captcha-img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%); }
        .captcha-icons-col { display: flex; flex-direction: column; justify-content: flex-start; gap: 8px; width: 16px; padding: 2px 0; }
        .c-icon { font-size: 14px; color: #999; text-align: center; }

        .search-pill-container { width: 100%; display: flex; justify-content: center; margin-top: 10px; }
        .search-pill { background: #fff; padding: 6px 18px; border-radius: 30px; font-size: 12px; color: #888; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; border: none; width: auto; }
        
        /* ★ Dock栏 - 底部安全区适配 */
.dock-capsule {
    position: absolute;
    bottom: calc(20px + var(--safe-bottom)); /* ★ 关键 */
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    height: 65px;
    background-color: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-radius: 40px;
    display: flex;
    justify-content: space-evenly;
    align-items: center;
    z-index: 100;
    box-shadow: 0 5px 25px rgba(0,0,0,0.05) !important;
}
        .dock-btn { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.1s; }
        .dock-btn:active { transform: scale(0.9); }
        .dock-btn img { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; }
        
        .popover-menu { position: absolute; background: #fff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); padding: 6px; display: none; flex-direction: column; width: 130px; z-index: 7000; animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .menu-item { padding: 10px; font-size: 13px; color: #333; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .menu-item:hover { background-color: #f5f5f7; }

        @media screen and (max-height: 750px) { .bubble-image-wrapper { height: 140px; } .info-card { padding-top: 40px; } .section-title { margin-top: 10px; } }

       .app-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-color);
    z-index: 300;
    display: flex;
    flex-direction: column;
    opacity: 0;
    pointer-events: none;
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.3s ease;
    transform: translateX(100%);
    padding-top: var(--safe-top); /* ★ 关键 */
    overflow: hidden;
    background-size: cover;
    background-position: center;
}
        .app-overlay.active { opacity: 1; pointer-events: auto; transform: translateX(0); }

        .chat-container { width: 100%; height: 100%; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        
        /* [修改] 背景改为透明，以便显示底层的 WeChat 壁纸 */
.tab-view { flex: 1; display: none; flex-direction: column; overflow-y: auto; overflow-x: hidden; width: 100%; position: relative; padding-bottom: calc(60px + var(--safe-bottom)); background: transparent; }
        .tab-view.active { display: flex; }

        .wechat-top-bar { position: relative; width: 100%; display: flex; justify-content: center; align-items: center; padding-top: 10px; padding-bottom: 5px; background: transparent; flex-shrink: 0; }
        .wechat-header-title { font-size: 16px; font-weight: 600; color: #000; }
        .wechat-plus-btn { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 18px; color: #333; cursor: pointer; padding-top: 5px; }

        .wechat-search-container { width: 100%; padding: 5px 0; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; background: transparent; position: relative; flex-shrink: 0; }
        .search-row-wrapper { display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; width: 100%; }
        .search-circle-btn { width: 20px; height: 20px; background-color: #007aff; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .search-circle-btn i { color: #fff; font-size: 10px; }
        .search-text-label { font-size: 15px; font-weight: 600; color: #333; position: relative; line-height: 1.2; }
        .search-text-label::after { content: ''; position: absolute; bottom: -4px; left: 0; width: 100%; height: 3px; background-color: #007aff; border-radius: 2px; }
        .wechat-pill-tabs { display: flex; align-items: center; justify-content: center; gap: 2px; background-color: #fff; padding: 4px; border-radius: 50px; width: fit-content; margin: 0 auto; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        .wechat-tab-btn { padding: 6px 14px; font-size: 13px; font-weight: 600; color: #888; border-radius: 40px; cursor: pointer; white-space: nowrap; transition: all 0.2s; background: transparent; }
        .wechat-tab-btn.active { background-color: #e6f2ff; color: #007aff; }

        .chat-dropdown { position: absolute; background: #fff; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); padding: 5px; display: none; flex-direction: column; width: 120px; z-index: 5001; top: calc(50px + var(--safe-top)); right: 15px; }
        .chat-dropdown-item { padding: 10px 12px; font-size: 13px; color: #333; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .chat-dropdown-item:hover { background-color: #f5f5f7; }
        
        /* [解释] 列表样式 - 侧滑逻辑修复 */
        .chat-list-container { flex: 1; width: 100%; padding: 10px 20px 0 20px; }
        
        .pinned-section, .normal-section { 
            width: 100%; display: flex; flex-direction: column; 
            background: #fff; border-radius: 18px; 
            padding: 4px 0; margin-bottom: 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.02);
            overflow: hidden;
        }
        
        /* [解释] 确保内容层在按钮层之上，实现侧滑 */
        .chat-item-wrapper { position: relative; width: 100%; height: 72px; overflow: hidden; background-color: #fff; border-radius: 0 !important; flex-shrink: 0; }
        .chat-item-content { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background-color: #fff; z-index: 10; 
            display: flex; align-items: center; padding: 0 15px; 
            transition: transform 0.2s cubic-bezier(0.2, 0.8, 0.2, 1); 
            cursor: pointer; 
            /* [修改] 修复侧滑时上下边缘透出红色的Bug */
            box-shadow: 0 0 0 1px #fff; 
        }
        .chat-item-content:active { background-color: #f9f9f9; }
        
        /* [修改] 按钮层稍微往里缩2px，防止闭合时边缘透出红色 */
        .chat-actions-right { 
            position: absolute; top: 0; right: 8px; height: 100%; 
            display: flex; z-index: 1; 
        }
        .action-btn { font-size: 13px; color: #fff; width: 70px; cursor: pointer; font-weight: 500; display: flex; align-items: center; justify-content: center; height: 100%; transition: background 0.2s; }
        .btn-cancel { background-color: #c7c7cc; } .btn-pin { background-color: #ff9f00; } .btn-del { background-color: #ff3b30; } 
        
        .chat-item-avatar { width: 48px; height: 48px; border-radius: 10px; object-fit: cover; margin-right: 12px; flex-shrink: 0; }
        .chat-item-text { flex: 1; display: flex; flex-direction: column; justify-content: center; overflow: hidden; pointer-events: none; /* 防止文字阻挡点击 */ }
        .chat-item-top { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 4px; }
        .chat-item-name { font-size: 15px; font-weight: 600; color: #000; }
        .chat-item-time { font-size: 11px; color: #999; }
        .chat-item-msg { font-size: 13px; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-height: 18px; }

        .chat-bottom-nav {
    position: absolute;
    bottom: calc(20px + var(--safe-bottom)); /* ★ 关键 */
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    height: 55px;
    background-color: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-radius: 50px;
    display: flex;
    justify-content: space-around;
    align-items: center;
    z-index: 600;
    box-shadow: 0 5px 20px rgba(0,0,0,0.05) !important;
}
        .chat-nav-item { font-size: 14px; color: #999; font-weight: 500; cursor: pointer; transition: all 0.2s; padding: 10px; }
        .chat-nav-item.active { color: #333; font-weight: 700; }

        #view-me { position: relative; }
        .me-header-container { position: relative; width: 92%; margin: 10px auto 20px auto; background: #fff; border-radius: 25px; height: 180px; display: flex; flex-direction: column; flex-shrink: 0; }
        .me-banner { width: 100%; height: 120px; border-radius: 25px 25px 0 0; object-fit: cover; cursor: pointer; }
        .me-avatar { position: absolute; bottom: 15px; left: 25px; width: 80px; height: 80px; border-radius: 50%; border: 4px solid #fff; object-fit: cover; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05); z-index: 10; }
        .me-slogan { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.9); padding: 4px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; color: #333; font-family: 'Courier New', Courier, monospace; cursor: pointer; }
        .me-list-container { width: 92%; margin: 0 auto; flex-shrink: 0; }
        .me-card-list { background: #fff; border-radius: 25px; padding: 5px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.02); display: flex; flex-direction: column; }
        .me-list-item { background: transparent; padding: 16px 25px; display: flex; align-items: center; justify-content: space-between; font-size: 15px; color: #333; font-weight: 500; cursor: pointer; border-bottom: 1px solid #f7f7f7; }
        .me-list-item:last-child { border-bottom: none; }
        .me-list-item:active { background-color: #f9f9f9; }
        .me-item-left { display: flex; align-items: center; gap: 12px; }
        .me-item-icon { font-size: 16px; color: #666; width: 24px; text-align: center; }
        .me-arrow { color: #ddd; font-size: 12px; }

        /* [新增] 字体设置页面样式 */
        .font-preview-box {
            background: #fff;
            color: #000;
            padding: 30px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 10px;
            border: 1px solid #eee;
            transition: all 0.3s;
        }
        .font-text-cn { font-size: 18px; font-weight: bold; word-break: break-all; }
        .font-text-en { font-size: 14px; color: #666; word-break: break-all; }
        
        .font-scheme-item {
            background: #fff;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            border: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.2s;
        }
        .font-scheme-item:active { transform: scale(0.98); background: #f9f9f9; }
        .font-scheme-left { display: flex; align-items: center; gap: 15px; }
        .font-preview-char { 
            font-size: 24px; 
            width: 50px; 
            height: 50px; 
            background: #f5f5f5; 
            border-radius: 8px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: #333;
        }
        .font-scheme-info { display: flex; flex-direction: column; }
        .font-scheme-name { font-size: 15px; font-weight: 600; color: #333; }
        .font-scheme-src { font-size: 11px; color: #999; max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .font-del-btn { padding: 8px; color: #ccc; }
        .font-del-btn:hover { color: #ff3b30; }

        .api-settings-page{
            position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-color);
    z-index: 3000;
    display: flex;
    flex-direction: column;
    transform: translateX(100%);
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    padding-top: var(--safe-top); /* ★ 关键 */
    overflow: hidden;
}
        .api-settings-page.active { transform: translateX(0); }
        .api-header { height: 50px; background: transparent; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; color: #000; margin-top: 10px; flex-shrink: 0; }
        .api-back-btn { font-size: 20px; cursor: pointer; width: 40px; }
        .api-title { font-size: 17px; font-weight: 600; }
        .api-content{
    flex: 1;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom: calc(100px + var(--safe-bottom)); /* ★ 关键 */
}
        
        .api-input-group { display: flex; flex-direction: column; gap: 8px; }
        .api-input-group label { font-size: 13px; color: #666; font-weight: 500; margin-left: 5px; }
        .api-input { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 12px; font-size: 15px; background: #fff; outline: none; transition: border 0.2s; }
        .api-input:focus { border-color: #333; }
        .api-row-flex { display: flex; gap: 10px; align-items: center; }
        .api-btn-small { padding: 14px 20px; background: #000; color: #fff; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; border: none; white-space: nowrap; }
        
        /* [修改] 背景改为灰色，方便看清白色的Dock条 */
        .dock-preview-wrapper { background: #e0e0e0; padding: 20px; border-radius: 20px; display: flex; justify-content: center; margin-bottom: 10px; }
        .dock-preview { width: 90%; height: 65px; background-color: rgba(255, 255, 255, 0.9); border-radius: 40px; display: flex; justify-content: space-evenly; align-items: center; }
        .dock-preview .dock-btn img { border-radius: 12px; }
        .app-preview-wrapper { display: flex; gap: 25px; justify-content: center; margin-bottom: 10px; padding: 10px; background: #ffffff; border-radius: 15px; }
        .app-preview-icon { width: 55px; height: 55px; background: #fff; border-radius: 18px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; font-size: 20px; color: #ccc; overflow: hidden; }
        .app-preview-icon img { width: 100%; height: 100%; object-fit: cover; }
        .edit-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .edit-card { background: #fff; padding: 12px; border-radius: 15px; display: flex; flex-direction: column; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        .edit-card-title { font-size: 13px; font-weight: 600; color: #333; }
        .edit-btns-row { display: flex; gap: 5px; width: 100%; }
        .edit-btn { flex: 1; padding: 6px 0; font-size: 10px; background: #f2f2f7; border-radius: 8px; text-align: center; cursor: pointer; border: none; color: #333; }
       /* 1. 强制设定预览框的大小 */
#wallpaperPreviewBox, 
#wcWallpaperPreviewBox,
#chatRoomWallpaperPreviewBox { /* <--- 必须加上这一行 */
    width: 100px !important;       
    height: 180px !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    overflow: hidden !important;
    border: 2px solid #fff !important;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1) !important;
    background-color: #f2f2f2;
    margin: 0 auto 5px auto !important;
}

/* 2. 强制图片“缩略”显示，绝不裁剪 */
#wallpaperPreviewImg, 
#wcWallpaperPreviewImg,
#chatRoomWallpaperPreviewImg { /* <--- 必须加上这一行 */
    width: 100% !important;
    height: 100% !important;
    object-fit: contain !important; 
    display: block;
    background-color: transparent !important;
}
        /* Generic Modals */
        .placeholder-page { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: #ccc; font-size: 18px; font-weight: bold; }
        .generic-page { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 5000; display: none; justify-content: center; align-items: flex-end; opacity: 0; transition: opacity 0.3s; padding-bottom: var(--safe-bottom); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); }
        .modal-overlay.show { opacity: 1; }
        .modal-box { background: #fff; width: 100%; max-height: 85vh; overflow-y: auto; border-radius: 20px 20px 0 0; padding: 25px 25px 40px 25px; display: flex; flex-direction: column; align-items: center; box-shadow: 0 -10px 40px rgba(0,0,0,0.1); transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1); }
        .modal-overlay.show .modal-box { transform: translateY(0); }
        .modal-title { font-size: 18px; font-weight: 700; margin-bottom: 20px; color: #333; }
        .modal-avatar { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #f0f0f0; object-fit: cover; margin-bottom: 10px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .modal-avatar-hint { font-size: 11px; color: #999; margin-bottom: 20px; }
        .modal-input-group { width: 100%; margin-bottom: 15px; }
        .modal-label { font-size: 13px; color: #666; margin-bottom: 6px; display: block; font-weight: 500; }
        .modal-input { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 12px; font-size: 15px; background: #f9f9f9; outline: none; transition: border 0.2s; }
        .modal-input:focus { border-color: #333; background: #fff; }
        textarea.modal-input { height: 80px; resize: none; }
        .world-book-selector { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 12px; font-size: 14px; background: #fff; color: #888; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .world-book-selector.has-value { color: #333; }
        .modal-btns { width: 100%; display: flex; gap: 10px; margin-top: 10px; }
        .modal-btn { flex: 1; padding: 14px; border-radius: 14px; font-size: 15px; font-weight: 600; cursor: pointer; text-align: center; border: none; }
        .btn-cancel-modal { background: #f2f2f7; color: #333; }
        .btn-confirm-modal { background: #000; color: #fff; }
        
        .wb-modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 6000; display: none; justify-content: center; align-items: center; }
        .wb-modal-box { background: #fff; width: 80%; max-height: 60vh; border-radius: 15px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 5px 25px rgba(0,0,0,0.2); }
        .wb-header { padding: 15px; border-bottom: 1px solid #eee; font-weight: bold; text-align: center; }
        .wb-list { flex: 1; overflow-y: auto; padding: 10px; }
        .wb-item { padding: 10px; border-bottom: 1px solid #f5f5f5; display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .wb-checkbox { width: 18px; height: 18px; accent-color: #000; }
        .wb-confirm-btn { padding: 12px; background: #000; color: #fff; text-align: center; cursor: pointer; font-weight: bold; }

        .chat-room {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #fff;
    z-index: 800;
    display: flex;
    flex-direction: column;
    transform: translateX(100%);
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    padding-top: var(--safe-top); /* ★ 关键 */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}
        .chat-room.active { transform: translateX(0); }
        .room-header { height: 50px; background: transparent; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; font-size: 16px; font-weight: 600; color: #000; z-index: 10; margin-top: 10px; flex-shrink: 0; }
        .room-back-btn { font-size: 20px; cursor: pointer; width: 40px; }
        .room-header-right { display: flex; gap: 15px; width: 60px; justify-content: flex-end; }
        .room-header-icon { font-size: 18px; cursor: pointer; }
        .room-content { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; }
        .date-divider { align-self: center; background: rgba(0,0,0,0.1); color: #fff; padding: 4px 10px; border-radius: 12px; font-size: 11px; margin: 10px 0; }

/* ========================================= */
/* [应用] 你的专属气泡样式 (完美复刻) */
/* ========================================= */

/* 1. 消息行容器 */
.Miu-miu {
    display: flex;
    width: 100%;
    padding: 0 10px;
    
    /* ★★★ 关键：给底部留出空间，因为你的尾巴是 bottom: -15px ★★★ */
    margin-bottom: 2px !important; 
    
    /* 允许尾巴显示，不裁剪 */
    overflow: visible !important;
    
    /* 对齐方式 */
    align-items: center !important;
}

/* 2. 气泡包裹层 (为了让时间和内容并排或垂直) */
.Miu-miu .bubble-wrapper {
    display: flex;
    align-items: flex-end; /* 底部对齐时间 */
    gap: 8px;
    max-width: 75%;
    position: relative;
    overflow: visible !important; /* 再次确保不剪裁 */
    
    margin-top: 6px !important; 
}

/* --- 以下是你提供的 CSS 内容 (应用到 .content) --- */

/* 气泡通用样式 */
.Miu-miu.user .content,
.Miu-miu.ai .content {
  --top-left: 18px;
  --top-right: 18px;
  --bottom-right: 18px;
  --bottom-left: 18px;
  
  padding: 6px 11px;
  position: relative;
  word-wrap: break-word;
  font-size: 12px;
  line-height: 1.3;
  z-index: 2; /* 保证内容在尾巴上面 */
}

/* User (我方) - 右对齐 */
.Miu-miu.user {
    justify-content: flex-end; /* 这一行保证气泡在右边 */
}

.Miu-miu.user .content {
  background-color: #929292; /* 你的灰色 */
  color: #fff;
  /* 去掉了 margin-right: auto，否则会跑到左边 */
  border-radius: var(--top-left) var(--top-right) var(--bottom-right) var(--bottom-left);
  box-shadow: none;
}

/* AI (对方) - 左对齐 */
.Miu-miu.ai {
    justify-content: flex-start; /* 这一行保证气泡在左边 */
}

.Miu-miu.ai .content {
  background-color: #fff; /* 你的白色 */
  color: #000;
  /* 去掉了 margin-left: auto */
  border-radius: var(--top-left) var(--top-right) var(--bottom-right) var(--bottom-left);
  box-shadow: none;
}

/* --- 你的小尾巴代码 (完全保留) --- */

/* 用户气泡小尾巴 */
.Miu-miu.user .content::after {
  content: "";
  position: absolute;
  width: 12px;
  height: 15px;
  bottom: -15px;  /* 你的设置 */
  right: 6px;     /* 你的设置 */
  background-color: #929292;
  clip-path: path("M 15,13 Q 12,0 2,2 Q 7,3 5,22 L 13,12");
  z-index: 1;     /* 在气泡下面 */
  transform: rotate(-2deg) scale(-1);
  transform-origin: top right;
  box-sizing: border-box;
}

/* AI气泡小尾巴 */
.Miu-miu.ai .content::before {
  content: "";
  position: absolute;
  width: 12px;
  height: 15px;
  bottom: -15px;  /* 你的设置 */
  left: -7px;     /* 你的设置 */
  background-color: #fff;
  clip-path: path("M 11,16 Q 10,0 1,1 Q 6.6,3 1,19 L 19,16");
  z-index: 1;     /* 在气泡下面 */
  transform: rotate(19deg) scaleY(-1); 
  transform-origin: top left;
  box-sizing: border-box;
}

/* 3. 修复头像位置 (如果不显示头像可忽略) */
.Miu-miu .avatar-img {
    width: 35px;
    height: 35px;
    border-radius: 12px;
    margin-top: 0;
    flex-shrink: 0;
}
.Miu-miu.ai .avatar-img { margin-right: 8px; }
.Miu-miu.user .avatar-img { margin-left: 8px; }

/* 4. 时间位置修正 */
.Miu-miu .time {
    font-size: 10px;
    color: #999;
    margin-bottom: 2px; /* 与气泡底边对齐 */
    white-space: nowrap;
}
/* ========================================= */
/* ★★★ [全新] 语音气泡样式 (图片复刻版) ★★★ */
/* ========================================= */

/* 1. 作用于 .content 容器，当它是语音气泡时 */
.Miu-miu .content.voice-bubble {
    /* 核心：让内部元素横向排列，垂直居中 */
    display: flex !important;
    align-items: center !important;
    justify-content: flex-start !important; /* 图标靠左 */
    gap: 8px; /* 图标和时长的间距 */

    /* 设定一个最小宽度，防止太窄 */
    min-width: 65px;
    padding-left: 14px !important; /* 给左侧图标多一点空间 */
    padding-right: 14px !important;
    
    /* 颜色继承自 .Miu-miu.ai .content 和 .Miu-miu.user .content */
    /* 我们不需要在这里设置 background-color，它会自动匹配文字气泡 */

    /* ★★★ 关键：让气泡宽度根据内容自适应 ★★★ */
    width: auto !important;
    display: inline-flex !important; /* 使用 inline-flex 实现自适应宽度 */
}

/* 2. 语音气泡内部的图标和时长文字的样式 */
.Miu-miu .content.voice-bubble .voice-icon,
.Miu-miu .content.voice-bubble .voice-duration {
    font-size: 14px;
    font-weight: 500;
    line-height: 1;
}

/* 3. AI的语音气泡内元素颜色 (白色) */
.Miu-miu.ai .content.voice-bubble .voice-icon,
.Miu-miu.ai .content.voice-bubble .voice-duration {
    color: #ffffff;
}

/* 4. 用户的语音气泡内元素颜色 (白色) */
/* 你的用户气泡是#929292灰色，所以内部元素也是白色 */
.Miu-miu.user .content.voice-bubble .voice-icon,
.Miu-miu.user .content.voice-bubble .voice-duration {
    color: #ffffff;
}
        /* ========================================= */
        /* ★★★ 修复：头部大图 (Header) ★★★ */
        /* ========================================= */
        /* 搜索 bubble-image-wrapper 替换原来的 */
        .bubble-image-wrapper { 
            position: relative; width: 92%; height: 175px; min-height: 140px; 
            z-index: 1; border-radius: 25px 25px 0 0; overflow: hidden; 
            cursor: pointer; flex-shrink: 0; 
            box-shadow: 0 -2px 10px rgba(0,0,0,0.02); 
        }
        .bubble-image { 
            width: 100%; height: 100%; 
            /* 关键属性：object-fit: cover 确保填满不变形 */
            object-fit: cover; 
            object-position: center; 
            display: block; 
        }
        .chat-settings-page{
         position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-color);
    z-index: 3000;
    display: flex;
    flex-direction: column;
    transform: translateX(100%);
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    padding-top: var(--safe-top); /* ★ 关键 */
    overflow: hidden;
}
        .chat-settings-page.active { transform: translateX(0); }
        .settings-header { height: 50px; background: transparent; display: flex; align-items: center; padding: 0 15px; font-size: 17px; font-weight: 600; color: #000; margin-top: 10px; flex-shrink: 0; }
        .settings-back-btn { font-size: 20px; margin-right: 15px; cursor: pointer; }
        .settings-content {
    flex: 1;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom: calc(100px + var(--safe-bottom)); /* ★ 关键 */
}
        .settings-profile-row { display: flex; justify-content: space-around; width: 100%; margin-bottom: 30px; }
        .settings-profile-col { display: flex; flex-direction: column; align-items: center; width: 45%; }
        /* [修改] 强制两个头像尺寸一致，且不被挤压 */
        .settings-avatar { 
            width: 80px; 
            height: 80px; 
            border-radius: 20px; 
            object-fit: cover; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            margin-bottom: 10px; 
            cursor: pointer; 
            flex-shrink: 0; /* 防止被挤压 */
        }
        .settings-real-name-display { font-size: 14px; font-weight: bold; color: #666; margin-bottom: 5px; }
        .settings-display-name { font-size: 16px; font-weight: bold; color: #000; cursor: pointer; padding: 4px 8px; border-radius: 8px; background: rgba(0,0,0,0.03); }
        .settings-menu { width: 100%; background: #fff; border-radius: 15px; overflow: hidden; }
        /* [新增] 聊天设置页的新卡片样式 */
        .settings-card-box {
            background: #fff;
            width: 100%;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px; /* 元素之间的间隔，无分割线 */
            box-shadow: 0 2px 10px rgba(0,0,0,0.02);
        }
        .settings-label {
            font-size: 13px;
            font-weight: 700;
            color: #333;
            margin-left: 5px;
        }
        .settings-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 12px;
            font-size: 14px;
            background: #f9f9f9;
            outline: none;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }
        .code-font {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            color: #333;
            background: #f5f5f5;
            min-height: 150px;
        }
        .save-float-btn {
            background: #000;
            color: #fff;
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            margin-top: 5px;
        }
        .settings-spacer { height: 10px; } /* 纯粹的间隔 */
        .settings-item { padding: 15px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; cursor: pointer; font-size: 15px; }
        .settings-item:last-child { border-bottom: none; }
        .settings-item.danger { color: #ff3b30; }

        /* World Book Settings Page (REDESIGN) */
        .wb-settings-page {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-color);
    z-index: 3000;
    display: flex;
    flex-direction: column;
    transform: translateX(100%);
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    padding-top: var(--safe-top); /* ★ 关键 */
    overflow: hidden;
}
        .wb-settings-page.active { transform: translateX(0); }
        .wb-main-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; flex-shrink: 0; }
        .wb-main-title { font-size: 22px; font-weight: 700; color: #000; }
        .wb-add-icon { font-size: 20px; cursor: pointer; padding: 5px; }
        
        .wb-filter-section { padding: 10px 20px; flex-shrink: 0; }
        .wb-filter-card { background: #fff; border-radius: 18px; padding: 15px; display: flex; flex-direction: column; gap: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .wb-filter-label { font-size: 12px; font-weight: 600; color: #666; }
        
        /* [解释] 优化的筛选触发按钮 */
        .wb-filter-trigger { border: 1px solid #eee; border-radius: 12px; padding: 12px; font-size: 14px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; background-color: #f9f9f9; color: #333; font-weight: 500; }
        .wb-filter-trigger:active { background-color: #f0f0f0; }

        .wb-content-area { flex: 1; overflow-y: auto; padding: 10px 20px 50px 20px; }
        .wb-group-card { background: #fff; border-radius: 18px; padding: 5px 0; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.02); overflow: hidden; }
        .wb-group-title { padding: 10px 15px; font-size: 12px; font-weight: 600; color: #999; border-bottom: 1px solid #f9f9f9; }
        .wb-book-item { padding: 15px; border-bottom: 1px solid #f7f7f7; display: flex; justify-content: space-between; align-items: center; font-size: 15px; }
        .wb-book-item:last-child { border-bottom: none; }

        /* [解释] 底部筛选面板 (Action Sheet) */
        .sheet-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 4000; opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(2px); -webkit-backdrop-filter: blur(2px); }
        .sheet-overlay.active { opacity: 1; pointer-events: auto; }
        .bottom-sheet { position: absolute; bottom: 0; left: 0; width: 100%; background: #fff; border-radius: 20px 20px 0 0; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1); padding-bottom: calc(20px + var(--safe-bottom)); display: flex; flex-direction: column; overflow: hidden; }
        .sheet-overlay.active .bottom-sheet { transform: translateY(0); }
        .sheet-header { padding: 15px; text-align: center; font-size: 14px; color: #999; font-weight: 500; border-bottom: 1px solid #eee; }
        .sheet-option { padding: 10px 20px; font-size: 16px; color: #333; text-align: center; border-bottom: none; cursor: pointer; }
        .sheet-option:active { background-color: #f5f5f5; }
        .sheet-option.selected { color: #000; font-weight: bold; position: relative; }
        .sheet-option.selected::after { content: '✓'; position: absolute; right: 40px; color: #000; }
        .sheet-cancel { margin-top: 8px; border-top: 6px solid #f5f5f5; font-weight: bold; }

        /* [解释] 优化后的新建世界书弹窗 (防止横向溢出) */
        .wb-create-modal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); z-index: 3500; display: none; flex-direction: column; align-items: center; padding-top: calc(50px + var(--safe-top)); overflow-y: auto; }
        .wb-create-modal.show { display: flex; }
        .wb-create-card { width: 90%; max-width: 400px; background: #fff; border-radius: 25px; padding: 25px 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 20px; margin-bottom: 50px; border: 1px solid #eee; }
        .wb-create-title { font-size: 18px; font-weight: 700; text-align: center; }
        
        .wb-field { display: flex; flex-direction: column; gap: 8px; width: 100%; }
        .wb-field-label { font-size: 12px; font-weight: 600; color: #888; }
        .wb-field-input { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 12px; font-size: 14px; outline: none; background: #f9f9f9; box-sizing: border-box; }
        
        .wb-row-space { display: flex; justify-content: space-between; align-items: center; }
        .wb-toggle { width: 40px; height: 24px; background: #eee; border-radius: 20px; position: relative; cursor: pointer; transition: background 0.2s; }
        .wb-toggle.checked { background: #000; }
        .wb-toggle-knob { width: 20px; height: 20px; background: #fff; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: transform 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .wb-toggle.checked .wb-toggle-knob { transform: translateX(16px); }
        
        .wb-manage-link { font-size: 12px; color: #007aff; cursor: pointer; text-decoration: none; }
        .wb-sub-btn { font-size: 12px; padding: 5px 10px; background: #f0f0f0; border-radius: 8px; cursor: pointer; }
        
        .wb-entries-list { display: flex; flex-direction: column; gap: 15px; margin-top: 10px; width: 100%; }
        .wb-entry-row { display: flex; flex-direction: column; gap: 5px; background: #f9f9f9; padding: 6px; border-radius: 8px; position: relative; margin-bottom: 5px; }
        .wb-entry-input { width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 13px; background: #fff; box-sizing: border-box; }
        /* [解释] 内容输入框改为 Textarea 并设置高度 */
        textarea.wb-entry-input { height: 80px; resize: none; font-family: inherit; }
        .wb-del-entry { position: absolute; top: 10px; right: 10px; color: #ccc; cursor: pointer; padding: 5px; }

        .wb-entry-add-btn { text-align: center; padding: 10px; background: #f9f9f9; border-radius: 12px; font-size: 13px; color: #666; cursor: pointer; margin-top: 10px; font-weight: 600; }

        .wb-save-btn { width: 100%; padding: 15px; background: #000; color: #fff; border-radius: 15px; font-weight: 600; text-align: center; cursor: pointer; margin-top: 10px; }
        .wb-cancel-btn { width: 100%; padding: 15px; background: transparent; color: #999; text-align: center; cursor: pointer; font-size: 14px; }

        .wb-popover { position: absolute; top: 60px; right: 20px; background: #fff; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); display: none; flex-direction: column; width: 150px; z-index: 1150; }
        .wb-pop-item { padding: 12px 15px; font-size: 14px; border-bottom: 1px solid #f7f7f7; cursor: pointer; }
        .wb-pop-item:last-child { border-bottom: none; }

        /* Small overlay for Group/Char selection */
        .wb-mini-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index: 4500; display: none; justify-content: center; align-items: center; }
        .wb-mini-box { background: #fff; width: 80%; border-radius: 15px; padding: 15px; display: flex; flex-direction: column; gap: 10px; box-shadow: 0 5px 30px rgba(0,0,0,0.2); }
        .wb-mini-list { max-height: 200px; overflow-y: auto; }
        .wb-mini-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .wb-mini-del { color: red; font-size: 12px; cursor: pointer; }

        /* [修改] 极微小的抖动动画 */
        @keyframes shakeMode {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(0.2deg); }
            75% { transform: rotate(-0.2deg); }
            100% { transform: rotate(0deg); }
        }
        .wb-group-card.shaking {
            animation: shakeMode 0.25s infinite linear;
            transform: scale(0.95); /* 整体缩小 */
            margin: 10px 5px; /* 增加一点外边距以免太挤 */
            overflow: visible !important; /* 让红点能显示在框外 */
            border: 1px solid #ddd;
            cursor: default;
        }
        .wb-del-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 22px;
            height: 22px;
            background: #ff3b30;
            border-radius: 50%;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            cursor: pointer;
        }
        .wb-del-badge::before { content: '×'; font-weight: bold; margin-top: -2px;}
        
        /* --- [修正版] 记忆设置卡片样式 --- */

/* 通用行布局：左右对齐 */
.mem-row {
    display: flex;
    justify-content: space-between; /* 关键：让左边的字和右边的框分开 */
    align-items: center;
    margin-bottom: 12px;
    width: 100%;
}

/* 输入框样式 (保持在右侧) */
.mem-input-small {
    width: 60px;
    padding: 6px;
    border: 1px solid #eee;
    border-radius: 8px;
    text-align: center;
    background: #f9f9f9;
    font-size: 13px;
    outline: none;
    font-family: inherit;
}

/* 纯白立体按钮 */
.plump-btn {
    background: #ffffff;
    color: #333;
    border: 1px solid #e0e0e0;
    border-bottom: 4px solid #dcdcdc;
    border-radius: 15px;
    padding: 10px;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    width: 100%;
    margin-top: 5px;
}
.plump-btn:active {
    transform: translateY(2px);
    border-bottom: 2px solid #dcdcdc;
}

/* 总结记忆库 - 整体折叠头 */
.mem-bank-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 5px;
    cursor: pointer;
    margin-top: 5px;
    border-radius: 8px;
    transition: background 0.2s;
}
.mem-bank-header:active { background: #f5f5f5; }
.mem-bank-arrow {
    transition: transform 0.3s;
    font-size: 12px;
    color: #ccc;
}
.mem-bank-header.open .mem-bank-arrow { transform: rotate(90deg); }

/* 总结列表容器 (默认隐藏) */
#memSummaryContainer {
    display: none; /* 默认折叠 */
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
    padding: 5px;
    background: #f8f8fa;
    border-radius: 12px;
}

/* 单个总结卡片 (可编辑) */
.mem-summary-card {
    background: #fff;
    border: 1px solid #eee;
    border-radius: 10px;
    padding: 10px;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 5px;
}
.mem-card-date { font-size: 10px; color: #999; }
.mem-card-textarea {
    width: 100%;
    border: none;
    font-size: 13px;
    color: #333;
    resize: vertical;
    min-height: 60px;
    outline: none;
    font-family: inherit;
    background: transparent;
}
.mem-card-actions {
    display: flex;
    justify-content: flex-end;
    border-top: 1px solid #f9f9f9;
    padding-top: 5px;
}
.mem-del-btn-text { font-size: 11px; color: #ff3b30; cursor: pointer; padding: 2px 5px; }

/* 统计栏 (保持原样) */
.mem-stats-bar {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px dashed #eee;
    font-size: 11px;
    color: #999;
    font-family: monospace;
}
.mem-stat-item { display: flex; align-items: center; gap: 4px; }
/* ========================================= */
/* ★★★ [几何融合版] 无遮罩・支持换壁纸 ★★★ */
/* ========================================= */

/* 1. 聊天室容器：设置壁纸的地方 */
.chat-room {
    /* 下面这行表示：顶部是90%不透明的白，底部是完全透明，从而透出底下的壁纸 */
    background: #fff; 
    
    z-index: 800;
    display: flex;
    flex-direction: column;
 
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

/* 2. 头部容器 */
.folder-header-container {
    height: 54px;
    display: flex;
    align-items: flex-end;
    position: relative;
    z-index: 20;
    padding-left: 0;
    margin-bottom: -1px; 
}

/* 3. 左侧标签本体：保持白色，不透视壁纸 */
.folder-tab {
    position: relative;
    background-color: #fff; /* ★★★ 这里必须是白色，不要改 ★★★ */
    width: auto;
    min-width: 120px;
    height: 44px;
    border-radius: 16px 16px 0 0; 
    display: flex;
    align-items: center;
    padding-left: 15px;
    padding-right: 15px;
    gap: 8px;
    box-shadow: -2px -4px 10px rgba(0,0,0,0.05); 
    z-index: 30; 
}

/* 4. 连接曲线：保持白色 */
.folder-curve-connector {
    position: absolute;
    bottom: 0;
    right: -20px;
    width: 20px;
    height: 20px;
    background: transparent;
    box-shadow: -10px 0 0 0 #fff; /* ★★★ 必须是白色 ★★★ */
    border-bottom-left-radius: 16px;
    z-index: 30;
}

/* 5. 返回按钮 */
.folder-back-btn {
    font-family: Arial, sans-serif;
    font-size: 26px;
    color: #666;
    font-weight: 300;
    cursor: pointer;
    line-height: 1;
    margin-top: -2px;
    padding: 5px;
}

/* 6. 标题 */
.folder-title {
    font-size: 16px;
    font-weight: 600;
    color: #000;
    white-space: nowrap;
}

/* 7. 右侧菜单按钮 */
.folder-right-space {
    flex: 1;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 15px;
    padding-bottom: 10px;
}

.folder-menu-btn {
    width: 32px;
    height: 32px;
    background: #fff; /* 按钮保持白色 */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08); 
    cursor: pointer;
    color: #333;
    font-size: 14px;
}

/* 8. 内容区域（你画红圈的部分）：改为上白下透的渐变！ */
.room-content {
    /* ★★★ 修改这里：从上(纯白)到下(透明)的渐变 ★★★ */
    /* 0% 是顶部纯白，100% 是底部完全透明(透出背景) */
    background: linear-gradient(180deg, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.8) 30%, rgba(255, 255, 255, 0) 100%) !important; 
    
    border-top-right-radius: 20px; 
    border-top-left-radius: 0; 
    
    position: relative;
    z-index: 10; 
    
    /* 稍微保留一点阴影让右侧边缘有层次感，或者去掉也可以 */
    box-shadow: 2px -2px 10px rgba(0,0,0,0.02); 
    
    flex: 1; 
    padding: 15px 5px 100px 5px !important; 
    gap: 0 !important; 
    
    display: flex;
    flex-direction: column;
}
/* ========================================================= */
/* ★★★ [修复] 美化中心卡片布局 (对应图5/6/7) ★★★ */
/* ========================================================= */

/* 2. 双列网格布局核心 (修复图2/3/4的单列问题) */
.edit-grid {
    display: grid !important; /* 强制网格 */
    grid-template-columns: 1fr 1fr; /* 两列等宽 */
    gap: 15px; /* 间距 */
    width: 100%;
    margin-bottom: 25px;
}
/* --- [修改] 极简气泡设置样式 --- */

/* 1. 颜色选择器：改为单行滑动或紧凑网格 */
.color-selector-wrapper {
    display: flex;
    gap: 15px;
    overflow-x: auto; /*如果颜色多可以横向滑动*/
    padding: 5px 2px;
    margin-bottom: 15px;
    scrollbar-width: none; /* 隐藏滚动条 */
}
.color-selector-wrapper::-webkit-scrollbar { display: none; }

.color-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    transition: transform 0.2s;
    min-width: 40px; /* 保证点击面积 */
}
.color-option:active { transform: scale(0.9); }

/* 纯粹的圆圈，双色拼接 */
.color-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 1px solid #e0e0e0;
    position: relative;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
/* 左半边：对方颜色 */
.c-half-left { position: absolute; left: 0; top: 0; width: 50%; height: 100%; }
/* 右半边：我方颜色 */
.c-half-right { position: absolute; right: 0; top: 0; width: 50%; height: 100%; }

/* 极简名字：2个字 */
.color-name { font-size: 11px; color: #666; font-weight: 500; }

/* --- [新增] 贴图式气泡预览专用样式 (完美适配你的新气泡) --- */
.img-preview-wrapper {
    position: relative;
    width: 100%;
    /* 关键：改为 visible，否则bottom: -15px的尾巴会被切掉 */
    overflow: visible; 
    border-radius: 12px;
    margin-top: 10px;
}

/* 背景图 */
.img-preview-bg {
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
    /* 图片圆角 */
    border-radius: 12px; 
    pointer-events: none; 
}

/* 通用定位容器 */
.preview-overlay-box {
    position: absolute;
    max-width: 80%; 
    display: flex;
    flex-direction: column;
    z-index: 10;
}

/* 左侧贴图 (对方) 位置 */
.preview-pos-left {
    top: 35%;     
    left: 15px;    
    align-items: flex-start;
}

/* 右侧贴图 (我方) 位置 */
.preview-pos-right {
    top: 65%;     
    right: 15px;   
    align-items: flex-end;
}

/* --- 预览区内部气泡强制重置 --- */
.img-preview-wrapper .Miu-miu {
    margin: 0 !important;
    padding: 0 !important;
    width: auto !important;
    display: flex !important;
    align-items: flex-start !important; /* 头像对齐 */
    overflow: visible !important; /* 关键：允许尾巴伸出 */
    margin-bottom: 5px !important;
}

/* 预览区内容微调 */
.img-preview-wrapper .Miu-miu .content {
    font-size: 12px;
    padding: 6px 11px;
    white-space: normal;
    min-height: 0;
    line-height: 1.4;
    position: relative !important; /* 确保尾巴定位基准正确 */
}

/* ★★★ 核心：强制预览区使用你的新尾巴样式 ★★★ */

/* User (右侧) 尾巴适配 */
.img-preview-wrapper .Miu-miu.user .content::after {
    content: "";
    position: absolute;
    width: 12px;
    height: 15px;
    
    /* 你的设置 */
    bottom: -15px !important; 
    right: 6px !important;    
    
    /* 形状路径 */
    clip-path: path("M 15,13 Q 12,0 2,2 Q 7,3 5,22 L 13,12"); 
    
    z-index: 1;
    transform: rotate(-2deg) scale(-1);
    transform-origin: top right;
    box-sizing: border-box;
}

/* AI (左侧) 尾巴适配 */
.img-preview-wrapper .Miu-miu.ai .content::before {
    content: "";
    position: absolute;
    width: 12px;
    height: 15px;
    
    /* 你的设置 */
    bottom: -15px !important; 
    left: -7px !important;    
    
    /* 形状路径 */
    clip-path: path("M 11,16 Q 10,0 1,1 Q 6.6,3 1,19 L 19,16");
    
    z-index: 1;
    transform: rotate(19deg) scaleY(-1);
    transform-origin: top left;
    box-sizing: border-box;
}

/* 预览里的头像样式 */
.img-preview-wrapper .avatar-img {
    width: 30px !important;
    height: 30px !important;
    border-radius: 10px !important;
    object-fit: cover;
    display: block !important;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    flex-shrink: 0;
    margin-top: 0 !important;
}

/* 头像间距 */
.img-preview-wrapper .Miu-miu.ai .avatar-img { margin-right: 8px !important; }
.img-preview-wrapper .Miu-miu.user .avatar-img { margin-left: 8px !important; }

/* 强制清除之前可能存在的干扰 */
.bubble-preview-container .Miu-miu { margin-bottom: 0 !important; }
/* 3. 折叠的预设管理器 (修复版) */
.preset-manager-toggle {
    margin-top: 15px;
    background: #fff;
    border: 1px solid #eee;
    padding: 12px;
    border-radius: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-size: 13px;
    color: #333;
    font-weight: 600;
    transition: background 0.2s;
}
.preset-manager-toggle:active { background: #f9f9f9; }

.preset-manager-body {
    display: none; /* 默认隐藏，JS控制为flex */
    background: #f8f8f8;
    margin-top: 5px;
    border-radius: 12px;
    padding: 15px;
    flex-direction: column;
    gap: 12px;
    animation: fadeIn 0.3s ease-out;
    border: 1px solid #eee;
}

/* 下拉框样式 */
.preset-select-row select {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ddd;
    outline: none;
    background: #fff;
    font-size: 13px;
    color: #333;
    height: 40px;
}

/* 按钮容器 */
.preset-btn-row {
    display: flex;
    gap: 10px;
    width: 100%;
}

/* 通用按钮样式 */
.preset-btn {
    flex: 1;
    padding: 12px 0;
    border-radius: 8px;
    border: none;
    font-size: 12px;
    color: #fff;
    cursor: pointer;
    font-weight: 600;
    text-align: center;
    transition: opacity 0.2s;
}
.preset-btn:active { opacity: 0.8; }

/* ★★★ 关键修复：给按钮加上颜色，否则白字看不见 ★★★ */
.btn-save-new { background-color: #EFEFEF; } /* 新建 */
.btn-update   { background-color: #EFEFEF; } /* 更新 */
.btn-delete   { background-color: #EFEFEF; } /* 删除 */

/* 提示文字 */
.preset-hint {
    font-size: 11px;
    color: #999;
    text-align: center;
    margin-top: 5px;
}

.room-footer {
    position: absolute !important;
    bottom: 0 !important;
    left: 0 !important;
    width: 100% !important;
    border-radius: 20px 20px 0 0 !important;
    background: #ffffff !important;
    box-shadow: 0 -2px 15px rgba(0,0,0,0.08) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    /* ★ 底部安全区适配 - 核心 */
    padding: 10px 12px calc(10px + var(--safe-bottom)) 12px !important;
    z-index: 2000 !important;
    transition: bottom 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) !important;
}

/* 两侧按钮 (+ 和 飞机) */
.footer-btn-side {
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #333;
    font-size: 22px;
    flex-shrink: 0; /* 禁止被挤压 */
    border-radius: 50%;
    cursor: pointer;
}
.footer-btn-side:active { background: #f5f5f5; }

/* 中间输入框 (关键修复) */
.msg-input {
    flex: 1 !important; /* 强制占满中间剩余空间 */
    background: #f2f2f2 !important;
    border: none !important;
    border-radius: 20px !important;
    padding: 8px 15px !important;
    margin: 0 10px !important; /* 左右留出间距，防止粘连 */
    
    font-size: 15px;
    color: #333;
    outline: none !important;
    
 /* 核心逻辑 */
    height: 38px;             /* 初始高度 */
    min-height: 38px !important; 
    max-height: 120px;        /* 最高撑到 120px，再多就内部滚动 */
    overflow-y: auto;         /* 垂直方向自动滚动 */
    overflow-x: hidden;       /* 禁用水平滚动以保证自动换行 */
    word-break: break-all;    /* 强制断句换行 */
    resize: none;             /* 禁止用户手动拖拽大小 */
}
/* ========================================= */
/* ★★★ [修复版] 抽屉式菜单样式 ★★★ */
/* ========================================= */

/* 1. 底栏动画：当添加 active 类时，向上滑动 */
.room-footer {
    transition: bottom 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) !important;
    z-index: 2000 !important; /* 保证底栏永远在最上面 */
}

.room-footer.tools-active {
    bottom: calc(280px + var(--safe-bottom)) !important; /* ★ 修正 */
}

/* 加号旋转动画 */
#plusIcon { transition: transform 0.3s; }
.room-footer.tools-active #plusIcon { transform: rotate(45deg); }

.chat-tools-panel {
    position: absolute;
    width: 100%;
    height: calc(280px + var(--safe-bottom)); /* ★ 加上安全区 */
    bottom: calc(-280px - var(--safe-bottom));
    left: 0;
    background: #FFFFFF;
    z-index: 1900;
    display: flex;
    flex-direction: column;
    padding: 20px;
    padding-bottom: calc(20px + var(--safe-bottom)); /* ★ 关键 */
    border-top: 1px solid #FFFFFF;
    transition: bottom 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
}

.chat-tools-panel.active {
    bottom: 0 !important;
}

/* 3. 菜单内容样式 */
.tools-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 25px;
}

.tool-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    width: 60px;
}

.tool-icon-box {
    width: 55px;
    height: 55px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    
    /* 修改这里：背景为纯白，图标颜色为纯黑 */
    background: #ffffff !important; 
    color: #000000 !important; 
    
    /* 添加一个淡淡的边框，防止白底按钮在白底面板上“隐身” */
    border: 1px solid #f0f0f0; 
    box-shadow: 0 2px 6px rgba(0,0,0,0.04); 
    cursor: pointer;
}

/* 按钮点击时的效果 */
.tool-icon-box:active {
    background: #f9f9f9 !important;
    transform: scale(0.95);
}

.tool-name { font-size: 12px; color: #666; }

/* 4. 表情包子页面 */
.sticker-panel {
    display: flex;
    flex-direction: column;
    height: 100%;
    animation: fadeIn 0.2s ease;
}
.sticker-header {
    display: flex;
    align-items: center;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
    margin-bottom: 10px;
}
.sticker-back-btn { padding: 5px 10px 5px 0; cursor: pointer; color: #333; }
.sticker-title { flex: 1; text-align: center; font-weight: bold; font-size: 14px; padding-right: 30px;}

.sticker-grid {
    flex: 1;
    overflow-y: auto;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    padding-bottom: 20px;
}
.sticker-option {
    width: 100%;
    aspect-ratio: 1;
    object-fit: contain;
    background: #fff;
    border-radius: 8px;
    padding: 5px;
    cursor: pointer;
}

/* 发送到聊天窗口里的表情图片大小 */
.chat-sticker-img {
    max-width: 120px;
    border-radius: 5px;
    display: block;
    margin: 2px 0;
}
/* --- [新增] 自定义表情包样式 --- */

/* 添加按钮样式 */
.sticker-add-btn {
    width: 100%;
    aspect-ratio: 1;
    border: 2px dashed #ccc;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #ccc;
    font-size: 24px;
    background: #f9f9f9;
    transition: all 0.2s;
}
.sticker-add-btn:active {
    background: #eee;
    border-color: #999;
    color: #999;
}

/* 使得添加按钮和表情混排时好看 */
.sticker-grid {
    /* 保持之前的 grid 布局 */
    grid-template-columns: repeat(4, 1fr); 
    align-content: start; /* 内容靠上 */
}

/* 如果表情太长了，名字可能显示不下，这里只显示图片，名字在点击发送时用到 */
.sticker-item-wrapper {
    position: relative;
    width: 100%;
    aspect-ratio: 1;
}

/* 删除角标 */
.sticker-del-btn {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 18px;
    height: 18px;
    background: #ff3b30;
    color: #fff;
    border-radius: 50%;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
/* ========================================= */
/* ★★★ [完整修复版] 纯表情包模式 (无气泡/无尾巴/限尺寸) ★★★ */
/* ========================================= */
/* 1. 容器：背景变透明，同时限制最大宽度 (双重保险) */
.Miu-miu .content.sticker-only {
    background: transparent !important;
    background-color: transparent !important;
    padding: 0 !important;
    box-shadow: none !important;
    border: none !important;
    
    /* ★★★ 新增：限制容器宽度，防止被撑开 ★★★ */
    max-width: 140px !important; 
    width: auto !important;
}

/* 2. 隐藏小尾巴 (User右边) - 必须保留！ */
.Miu-miu.user .content.sticker-only::after {
    display: none !important;
    content: none !important;
}

/* 3. 隐藏小尾巴 (AI左边) - 必须保留！ */
.Miu-miu.ai .content.sticker-only::before {
    display: none !important;
    content: none !important;
}

/* 3. 图片：这是最核心的限制 */
.Miu-miu .content.sticker-only img, 
.chat-sticker-img { 
    width: 55px !important;      /* 强制宽度为 120px */
    max-width: 55px !important;  
    height: auto !important;      /* 高度自适应，防止拉伸 */
    margin: 0 !important;
    border-radius: 8px; 
    display: block !important;   
}
/* ========================================= */
/* ★★★ [修改] 长按菜单样式 & iOS Q弹动画 ★★★ */
/* ========================================= */

.msg-popover {
    position: fixed;
    z-index: 9999;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 12px; 
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12); 
    display: none;
    padding: 0 5px;

    animation: iosSpringPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform: translateX(-50%) scale(0.8); 
    transform-origin: center bottom; 
}
@keyframes iosSpringPop {
    0% {
        opacity: 0;
        transform: translateX(-50%) scale(0.8) translateY(10px);
    }
    60% {
        opacity: 1;
        transform: translateX(-50%) scale(1.05) translateY(0);
    }
    100% {
        opacity: 1;
        transform: translateX(-50%) scale(1);
    }
}

.msg-popover-item {
    padding: 5px 10px; 
    color: #333;
    font-size: 11px;
    font-weight: 500;
    cursor: pointer;
    white-space: nowrap;
    display: flex;
    align-items: center;
    justify-content: center;
}
/* 点击态 */
.msg-popover-item:active {
    background-color: rgba(0, 0, 0, 0.05);
    border-radius: 8px;
}

/* 底部小三角箭头 */
.msg-popover-arrow {
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid rgba(255, 255, 255, 0.95);
}
/* --- [修复] 消息列表预览防爆图 --- */
.chat-item-msg img {
    display: none !important; /* 强制隐藏列表里的图片 */
}
/* 修改核心气泡样式，确保全局统一 */
.Miu-miu.user .content,
.Miu-miu.ai .content {
    padding: 6px 11px !important; 
    font-size: 12px !important;    
    line-height: 1.3;
    position: relative;
    word-wrap: break-word;
    z-index: 2;
}
/* 3. 区分 AI 和 User 的颜色与图标位置 */

/* AI (左侧：浅灰色背景，黑色字) */
.Miu-miu.ai .content.voice-bubble {
}
.Miu-miu.ai .voice-main-row {
    flex-direction: row !important; /* 图标在左，秒数在右 */
    justify-content: flex-start !important;
}

/* User (右侧：深黑色背景，白色字) */
.Miu-miu.user .content.voice-bubble {
}
.Miu-miu.user .voice-main-row {
    flex-direction: row-reverse !important; /* 秒数在左，图标在右 */
    justify-content: flex-start !important;
}

/* 4. 图标和秒数微调 */
.voice-icon {
    font-size: 14px !important;
}

.voice-duration {
    font-size: 13px !important;
}
/* 语音转文字框：白色半透明 + 黑色字体 */
.voice-trans-result {
    display: none; /* 默认隐藏 */
    margin-top: 8px; /* 与语音条的间距 */
    padding: 8px;
    background: rgba(255, 255, 255, 0.7) !important; /* 白色半透明 */
    color: #000000 !important; /* 强制黑色字体 */
    border-radius: 8px;
    font-size: 11px;
    line-height: 1.4;
    border: 1px solid rgba(255, 255, 255, 0.3);
    word-break: break-all;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

/* 当点击气泡后，加上这个 .show 类就会显示并撑开布局 */
.voice-trans-result.show {
    display: block !important;
}
/* 修复表情包面板布局崩塌 */
.sticker-header {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    padding: 10px 15px !important;
    width: 100% !important;
    border-bottom: 1px solid #f0f0f0;
    box-sizing: border-box;
}

.sticker-back-btn {
    flex-shrink: 0;
    font-size: 13px;
    color: #666;
    cursor: pointer;
    width: 60px; /* 给返回按钮固定宽度，防止标题挤压 */
}

.sticker-title {
    flex: 1;
    text-align: center;
    font-weight: bold;
    font-size: 14px;
    color: #333;
}
/* --- [新增] 优化语音气泡内部布局 --- */

/* 1. AI的语音气泡 (左侧) */
/* 让图标和时长两端对齐 */
.Miu-miu.ai .voice-main-row {
    display: flex;
    justify-content: space-between; /* 核心：让子元素两端对齐 */
    align-items: center;
    width: 100%; /* 确保容器占满宽度 */
}

/* 2. 用户的语音气泡 (右侧) */
/* 两端对齐，并且反转元素顺序，让图标在右边 */
.Miu-miu.user .voice-main-row {
    display: flex;
    justify-content: space-between; /* 核心：让子元素两端对齐 */
    flex-direction: row-reverse;   /* 核心：反转顺序，实现 图标在右，时长在左 */
    align-items: center;
    width: 100%; 
}